{% extends 'main/layout.html' %}
{% block title %}–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<div class="container my-5">
    <h1>üëë –ê–¥–º–∏–Ω-–ü–∞–Ω–µ–ª—å</h1>

    <h3>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
    <div class="row my-4">
        <div class="col-md-3 p-3 bg-light rounded shadow">
            <h4>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {{ total_users }}</h4>
        </div>
        <div class="col-md-3 p-3 bg-light rounded shadow">
            <h4>–ó–∞–∫–∞–∑–æ–≤: {{ total_orders }}</h4>
        </div>
        <div class="col-md-3 p-3 bg-light rounded shadow">
            <h4>–û—Ç–∑—ã–≤–æ–≤: {{ total_reviews }}</h4>
            <p>‚≠ê –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: {{ avg_rating }}</p>
        </div>
        <div class="col-md-3 p-3 bg-light rounded shadow">
            <h4>–û–±—â–∞—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂: {{ total_sales_sum }}</h4>
        </div>
    </div>

    <h3>–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂</h3>
    <table class="table table-striped">
        <thead>
            <tr><th>–ö–ª–∏–µ–Ω—Ç</th><th>–°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂</th></tr>
        </thead>
        <tbody>
            {% for user in user_sales %}
            {% if user.username != "admin" %}
            <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.total_sales }}</td>
            </tr>
            {% endif %}
            {% empty %}
            <tr><td colspan="2">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—É–º–º–µ –ø—Ä–æ–¥–∞–∂</h3>
    <ul>
        <li>–°—Ä–µ–¥–Ω–µ–µ: {{ avg_sales }}</li>
        <li>–ú–µ–¥–∏–∞–Ω–∞: {{ med_sales }}</li>
        <li>–ú–æ–¥–∞: {{ mode_sales }}</li>
    </ul>

<!--    <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É –∫–ª–∏–µ–Ω—Ç–æ–≤</h3>-->
<!--    <ul>-->
<!--        <li>–°—Ä–µ–¥–Ω–∏–π –≤–æ–∑—Ä–∞—Å—Ç: {{ avg_age }}</li>-->
<!--        <li>–ú–µ–¥–∏–∞–Ω–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç: {{ med_age }}</li>-->
<!--    </ul>-->

    <h3>üçï –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –ø–æ —Ç–∏–ø—É —Ç–æ–≤–∞—Ä–∞ (—Ä–∞–∑–º–µ—Ä—É –ø–∏—Ü—Ü—ã)</h3>
    <canvas id="popularChart" width="400" height="150"></canvas>

    <h3>üí∏ –ü—Ä–∏–±—ã–ª—å –ø–æ —Ç–∏–ø—É —Ç–æ–≤–∞—Ä–∞</h3>
    <canvas id="profitChart" width="400" height="150"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const popularLabels = [{% for pt in popular_types %}'{{ pt.pizza__size }}',{% endfor %}];
    const popularData = [{% for pt in popular_types %}{{ pt.count }},{% endfor %}];

    const profitLabels = [{% for pt in profit_by_type %}'{{ pt.pizza__name }}',{% endfor %}];
    const profitData = [{% for pt in profit_by_type %}{{ pt.profit|default:0 }},{% endfor %}];

    const ctxPopular = document.getElementById('popularChart').getContext('2d');
    new Chart(ctxPopular, {
        type: 'bar',
        data: {
            labels: popularLabels,
            datasets: [{
                label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤',
                data: popularData,
                backgroundColor: 'rgba(54, 162, 235, 0.7)'
            }]
        }
    });

    const ctxProfit = document.getElementById('profitChart').getContext('2d');
    new Chart(ctxProfit, {
        type: 'bar',
        data: {
            labels: profitLabels,
            datasets: [{
                label: '–ü—Ä–∏–±—ã–ª—å',
                data: profitData,
                backgroundColor: 'rgba(255, 99, 132, 0.7)'
            }]
        }
    });
</script>

{% endblock %}
